<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Torneo Cremesi — Sito Ufficiale (PF1e, ABP ON)</title>
  <link rel="icon" href="assets/favicon.png">
  <link rel="stylesheet" href="css/styles.css" />
  <meta name="theme-color" content="#e9506a" />
</head>
<body>
  <a class="skip-link" href="#app">Salta al contenuto principale</a>
  <button id="sidebarToggle" class="sidebar-toggle" aria-expanded="false" aria-controls="sidebar">
    <span class="sidebar-toggle__icon" aria-hidden="true">☰</span>
    <span class="sidebar-toggle__label">Menu</span>
  </button>
  <!-- Sidebar navigation -->
  <aside class="sidebar" id="sidebar" aria-hidden="false">
    <a class="brand" href="#/avvio">
      <img src="assets/logo.svg" alt="Logo" class="logo"/>
      <span>Torneo Cremesi</span>
    </a>
    <nav>
      <div class="nav-label">Navigazione</div>
      <a href="#/avvio" data-link>🚀 Avvio Rapido</a>
      <div class="nav-label">Parte A — Consultazione</div>
      <a href="#/ambientazione" data-link>🌍 Ambientazione</a>
      <a href="#/regole" data-link>🏆 Regole, PA, Cicatrici, Glossario</a>
      <a href="#/oggetti" data-link>💎 Oggetti Custom</a>
      <div class="nav-label">Parte B — Modificabile</div>
      <a href="#/scheda" data-link>📝 Scheda Compilabile</a>
      <a href="#/tracker" data-link>📊 Tracker PA & Cicatrici</a>
    </nav>
    <div class="sidebar-actions">
      <button id="btnExportJSON" class="btn">Esporta JSON</button>
      <button id="btnImportJSON" class="btn">Importa JSON</button>
      <button id="btnPrint" class="btn primary">Stampa / PDF</button>
    </div>
  </aside>

  <!-- Main content area where views are injected -->
  <main id="app" tabindex="-1">
    <!-- Le viste vengono iniettate via router definito in js/app.js -->
  </main>

  <!-- View templates (hidden in HTML, rendered by router) -->
  <script type="text/template" id="view-avvio">
    <header class="page-head">
      <h1>🚀 Avvio Rapido</h1>
      <p class="muted">Livello 7 • ABP ON • EITR ON • Budget 11.750 mo • No consumabili/slotless • 1 oggetto custom opzionale</p>
    </header>
    <section class="card">
      <h2>Checklist lampo</h2>
      <ul class="list">
        <li>Scegli 1 <b>Tratto di Campagna (TC)</b> (niente doppioni nel party).</li>
        <li>Applica <b>EITR</b> ai talenti.</li>
        <li>Rispetta <b>ABP ON</b>: evita i Big Six e i duplicati dei bonus coperti.</li>
        <li>Spendi ≤ <b>11.750 mo</b>. No consumabili/slotless all’avvio.</li>
        <li>Proponi 1 <b>Oggetto Custom</b> (opzionale): tema, effetto, trigger, prezzo, sinergie.</li>
        <li>Compila <b>Scheda</b> e leggi i <b>PA & Cicatrici</b> (resurrezione d’emergenza a 2 PA).</li>
      </ul>
      <div class="quicklinks">
        <a href="#/scheda" class="pill">→ Vai alla Scheda</a>
        <a href="#/oggetti" class="pill">→ Vai agli Oggetti Custom</a>
        <a href="#/regole" class="pill">→ Vai alle Regole & PA</a>
        <a href="#/ambientazione" class="pill">→ Vai all’Ambientazione</a>
        <a href="#/tracker" class="pill">→ Vai al Tracker</a>
      </div>
    </section>
    <section class="card">
      <h2>Creazione del Personaggio (riassunto)</h2>
      <ol class="list num">
        <li>Definisci <b>razza, classi e archetipi</b> e seleziona il tuo <b>TC</b>.</li>
        <li>Assegna le <b>statistiche</b> principali (Forza, Destrezza, etc.), mod, difese e attacchi.</li>
        <li>Scegli i <b>talenti</b> con EITR, i <b>tratti</b> (TC + 1; opzionale 3° con drawback) e gli eventuali <b>difetti</b>.</li>
        <li>Prepara <b>incantesimi</b> o capacità magiche e identifica le <b>abilità</b> chiave.</li>
        <li>Componi il <b>loadout</b> rispettando ABP/budget e progetta l’<b>oggetto custom</b> (se previsto).</li>
        <li>Scrivi una breve <b>descrizione</b>, definisci <b>palette</b>, <b>motto</b> e scegli un’immagine.</li>
      </ol>
      <p class="muted">Suggerimento: compila prima i campi essenziali e affina in gioco. Trovi il modulo completo nella sezione Scheda.</p>
    </section>
  </script>

  <script type="text/template" id="view-ambientazione">
    <header class="page-head">
      <h1>🌍 Ambientazione — Fangwood</h1>
      <p class="muted">Luna immobile • Discesa Celeste • Foresta antica e capricciosa</p>
    </header>
    <section class="card">
      <h2>TL;DR</h2>
      <ul class="list">
        <li>Arrivo in <b>Discesa Celeste</b>: risvegliatevi nella Fangwood senza ricordi del viaggio.</li>
        <li>La Fangwood è una foresta viva: <i>ascoltate</i> prima di agire e <i>restate uniti</i>.</li>
        <li>Presenze ai margini, simboli cremisi, la luna immobile: l’atmosfera è carica di mistero.</li>
      </ul>
    </section>
    <section class="card">
      <h2>Scena d’apertura</h2>
      <p>Dopo la Discesa Celeste, il cielo è solcato da comete bianche. Un cerchio di rune incandescente vi accoglie al vostro risveglio. La Proclamazione del Torneo risuona tra gli alberi mentre nebbia cremisi apre un varco nella Fangwood. Ricordate chi siete e il legame con il vostro TC, ma non come siete giunti qui. Presenze osservano dai bordi, invitandovi a proseguire.</p>
      <p>Il GM fornirà ulteriori dettagli narrativi durante l’introduzione. Questa sezione serve come riferimento rapido per l’ambientazione e le prime sensazioni della campagna.</p>
    </section>
  </script>

  <script type="text/template" id="view-regole">
    <header class="page-head">
      <h1>🏆 Regole • Sistema a Punti • Cicatrici • Glossario</h1>
      <p class="muted">Sistema: PF1e RAW Paizo • ABP ON • EITR ON • SSOT: questo sito e il compendio del tavolo</p>
    </header>
    <section class="card">
      <h2>Regole base & Toggles</h2>
      <ul class="list">
        <li><b>Livello iniziale:</b> 7.</li>
        <li><b>Fonti consentite:</b> esclusivamente materiale Paizo (no 3PP).</li>
        <li><b>EITR ON:</b> prerequisiti e tassazione talenti semplificati; consultate il profilo EITR del tavolo.</li>
        <li><b>ABP ON:</b> bonus di arma, armatura, scudo, deflessione, resistenza e enhancement alle caratteristiche sono gestiti in automatico; evitate duplicazioni di bonus.</li>
        <li><b>Budget equipaggiamento:</b> 11.750 mo per PG. Non sono consentiti consumabili o oggetti slotless all’avvio.</li>
      </ul>
    </section>
    <section class="card">
      <h2>🎲 Sistema a Punti (PA)</h2>
      <ul class="list">
        <li>Ogni personaggio inizia con <b>2 PA</b>.</li>
        <li><b>1 PA:</b> reroll di qualsiasi d20 (tuo, alleato o avversario).</li>
        <li><b>2 PA:</b> recupera PF massimi all’inizio del tuo turno <i>(azione di round completo)</i> <b>oppure</b> rimuovi tutte le condizioni.</li>
        <li><b>2 PA:</b> resurrezione d’emergenza: torni in vita con 1 PF e acquisisci una cicatrice narrativa.</li>
        <li><b>Limite:</b> 1 effetto PA per round per personaggio.</li>
        <li><b>Corruzione:</b> alcune scelte (fallimenti critici, tradimenti, condotta codarda) generano malus <i>–1 ai PA ottenuti per evento</i> (min. 0).</li>
      </ul>
    </section>
    <section class="card">
      <h2>🩹 Cicatrici & Corruzione (sintesi)</h2>
      <ul class="list">
        <li>Potete accumulare fino a 3 cicatrici fisiche e 3 psicologiche senza malus immediati.</li>
        <li>Due cicatrici sulla stessa caratteristica comportano –1 permanente a quella caratteristica.</li>
        <li>Le cicatrici possono essere curate con 2 PA o tramite magie appropriate.</li>
      </ul>
    </section>
    <section class="card">
      <h2>🎁 Ricompense & Loot (ABP)</h2>
      <ul class="list">
        <li><b>Niente duplicati</b> dei bonus coperti da ABP (arma/armatura/scudo, deflessione, resistenza, enhancement alle caratteristiche, ecc.).</li>
        <li><b>Ricompense tematiche:</b> utility narrative legate a sensi, movimento, comunicazione, chiavi narrative (sigilli, emblemi) o effetti limitati al torneo.</li>
        <li><b>Indipendenza dai TC:</b> gli oggetti non replicano né potenziano direttamente i poteri dei Tratti di Campagna (TC01–TC06).</li>
      </ul>
      <p class="muted">Consulta la sezione <a href="#/oggetti">Oggetti Custom</a> per esempi di ricompense e il manuale del GM per linee guida complete.</p>
    </section>
<section class="card">
  <h2>📌 Glossario lampo</h2>
  <p><b>LI</b> = Livello Incantatore; <b>TS</b> = Tiri Salvezza; <b>TxC</b> = Tiro per Colpire; <b>PF</b> = Punti Ferita; <b>CD</b> = Classe Difficoltà; <b>RD</b> = Riduzione del Danno; <b>SR</b> = Resistenza agli Incantesimi; <b>RAW</b> = Rules As Written; <b>HR</b> = House Rules.</p>
  <p><b>Unità & formati:</b> moneta in <i>gp</i>, peso in <i>lb</i>, distanze in metri, tempo in round/minuti/ore.</p>
  <p><b>Incantesimi</b> sono indicati in <i>corsivo</i>; <b>condizioni</b> (es. <b>accecato</b>, <b>sfocatura</b>) in grassetto.</p>
  <p><b>Tipi di bonus:</b> competenza, circostanziale, schivare, morale, sacro, ecc.; evita duplicare bonus dello stesso tipo (ABP li copre già).</p>
  <p>Consulta il compendio del tavolo per la lista completa di termini e definizioni.</p>
</section>
  </script>

  <script type="text/template" id="view-oggetti">
    <header class="page-head">
      <h1>💎 Oggetti Custom</h1>
      <p class="muted">Archivio locale di oggetti magici custom sviluppati per il Torneo Cremesi. Puoi creare, modificare e cercare oggetti; la scheda collegata li importa tramite il selettore.</p>
    </header>
    <section class="card">
      <h2>Catalogo (salvato in locale)</h2>
      <div class="row">
        <input id="ocSearch" placeholder="Cerca per nome, slot o tag…" />
        <button id="btnNewOC" class="btn">+ Nuovo oggetto</button>
        <button id="btnSeedOC" class="btn">Carica esempi</button>
      </div>
      <table class="table" id="ocTable">
        <thead><tr>
          <th>Nome</th>
          <th>Slot</th>
          <th>LI</th>
          <th>Prezzo</th>
          <th>Rarità</th>
          <th></th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </section>
    <section class="card">
      <h2>Editor Oggetto</h2>
      <div class="grid g3">
        <div><label>Nome</label><input id="ocNome"></div>
        <div><label>Slot</label><input id="ocSlot" placeholder="Testa/Spalle/Occhi/Collo/Anello/—"></div>
        <div><label>LI</label><input id="ocLI" type="number" min="1"></div>
        <div><label>Prezzo (gp)</label><input id="ocPrezzo" type="number" min="0" step="50"></div>
        <div><label>Rarità</label><select id="ocRarita">
          <option>Comune</option>
          <option>Non comune</option>
          <option>Raro</option>
          <option>Unico</option>
        </select></div>
        <div><label>[HR]</label><select id="ocHR"><option>No</option><option>Sì</option></select></div>
      </div>
      <div class="grid g2">
        <div><label>Azioni / Usi / Durata</label><input id="ocAzioni" placeholder="Veloce; 1/g; 1 min"></div>
        <div><label>TS / SR</label><input id="ocTS" placeholder="Tempra CD 15; SR: No"></div>
      </div>
      <div class="grid">
        <label>Effetto (1 riga)</label><input id="ocEffetto"/>
      </div>
      <div class="grid">
        <label>Dettagli (max 3 bullet — una per riga)</label>
        <textarea id="ocDettagli" placeholder="- …&#10;- …&#10;- …"></textarea>
      </div>
      <div class="row">
        <button id="btnSaveOC" class="btn primary">Salva/aggiorna</button>
        <button id="btnDeleteOC" class="btn">Elimina</button>
        <span id="ocStatus" class="muted"></span>
      </div>
    </section>
  </script>

  <script type="text/template" id="view-scheda">
    <header class="page-head">
      <h1>📝 Scheda Compilabile</h1>
      <p class="muted">Salvataggio automatico in localStorage • Esporta/Importa JSON • Stampa PDF</p>
    </header>
    <section class="card">
      <h2>Dati Anagrafici</h2>
      <div class="grid g2">
        <div><label>Nome PG</label><input id="nome"/></div>
        <div><label>Razza / Classi / Archetipi</label><input id="razzaClassi"/></div>
        <div><label>Livello Totale</label><input id="livello" value="7"/></div>
        <div><label>Allineamento / Divinità</label><input id="allineamento"/></div>
        <div><label>Taglia / Età / Sesso</label><input id="taglia"/></div>
        <div><label>Altezza / Peso</label><input id="altezza"/></div>
      </div>
    </section>
    <section class="card">
      <h2>Dati Fisici</h2>
      <div class="grid g3">
        <div><label>Palette</label><input id="palette"/></div>
        <div><label>Motto</label><input id="motto"/></div>
        <div><label>Immagine (URL)</label><input id="imgUrl" placeholder="https://…"/></div>
      </div>
      <div class="grid"><label>Descrizione</label><textarea id="descrizione"></textarea></div>
    </section>
    <section class="card stats">
      <h2>Statistiche</h2>
      <table>
        <thead><tr><th>Stat</th><th>Val</th><th>Mod</th></tr></thead>
        <tbody id="statsBody"></tbody>
      </table>
    </section>
    <section class="card">
      <h2>Tratto di Campagna</h2>
      <div class="grid g3">
        <div><label>Seleziona TC</label><select id="tcSelect"></select></div>
        <div><label>Codice</label><input id="tcCode" readonly/></div>
        <div><label>Titolo</label><input id="tcTitle" readonly/></div>
      </div>
      <div class="grid g2">
        <div><label>Narrativa (auto)</label><textarea id="tcNarr" readonly></textarea></div>
        <div><label>Regole RAW (auto)</label><ul id="tcRaw" class="auto-list"></ul></div>
      </div>
    </section>
    <section class="card">
      <h2>Talenti, Tratti & Difetti</h2>
      <div class="grid">
        <div><label>Talenti (EITR ON)</label><textarea id="talenti"></textarea></div>
        <div><label>Tratti</label><textarea id="tratti"></textarea></div>
        <div><label>Difetti</label><textarea id="difetti"></textarea></div>
      </div>
    </section>
    <section class="card">
      <h2>Difese</h2>
      <div class="grid g4">
        <div><label>PF totali</label><input id="pf"/></div>
        <div><label>CA Tot / Cont / Sorpr.</label><input id="ca" placeholder="— / — / —"/></div>
        <div><label>TS (Temp / Rif / Vol)</label><input id="ts" placeholder="— / — / —"/></div>
        <div><label>BAB</label><input id="bab"/></div>
        <div><label>CMB / CMD</label><input id="cmbcmd" placeholder="— / —"/></div>
        <div><label>Iniziativa</label><input id="iniziativa"/></div>
        <div><label>Velocità</label><input id="velocita"/></div>
      </div>
    </section>
    <section class="card">
      <h2>Attacchi & Manovre</h2>
      <div class="grid">
        <table>
          <thead><tr><th>Arma / Attacco</th><th>Attacco Totale</th><th>Danni</th><th>Critico</th><th>Portata</th><th>Note</th></tr></thead>
          <tbody id="atkTable"></tbody>
        </table>
        <button class="btn" id="btnAddAtkRow">+ riga</button>
      </div>
      <div class="muted" style="margin-top:8px">
        Manovre CMB: Disarm — · Trip — · Grapple — · Bull Rush — · Sunder —
      </div>
    </section>
    <section class="card">
      <h2>Abilità (principali)</h2>
      <textarea id="skills" placeholder="Percezione — ; Furtività — ; Sopravvivenza — ; Sapienza Magica — ; Acrobazia — ; Diplomazia — ; Intuizione —."></textarea>
    </section>
    <section class="card">
      <h2>Incantesimi / Capacità</h2>
      <div class="grid">
        <table>
          <thead><tr><th>Livello</th><th>Slot/giorno</th><th>CD base</th><th>Incantesimi principali</th></tr></thead>
          <tbody id="spellTable">
            <tr><td>0°</td><td contenteditable></td><td contenteditable></td><td contenteditable></td></tr>
            <tr><td>1°</td><td contenteditable></td><td contenteditable></td><td contenteditable></td></tr>
            <tr><td>2°</td><td contenteditable></td><td contenteditable></td><td contenteditable></td></tr>
            <tr><td>3°</td><td contenteditable></td><td contenteditable></td><td contenteditable></td></tr>
          </tbody>
        </table>
      </div>
    </section>
    <section class="card">
      <h2>Equipaggiamento & Budget</h2>
      <div class="grid">
        <input id="loadout" placeholder="Loadout principale…"/>
        <input id="altro" placeholder="Altro…"/>
        <div class="grid g3">
          <div><label>Budget rimanente (mo)</label><input id="budget"/></div>
          <div><label>PP / GP / SP / CP</label><input id="valute" placeholder="PP __ / GP __ / SP __ / CP __"/></div>
        </div>
      </div>
    </section>
    <section class="card">
      <h2>Oggetto Custom su Misura</h2>
      <div class="grid g3">
        <div>
          <label>Scegli dall’Archivio Oggetti</label>
          <select id="ocPicker"></select>
        </div>
        <div><label>Trigger / Limiti</label><input id="customTrigger"/></div>
        <div><label>Prezzo stimato</label><input id="customCosto"/></div>
      </div>
      <input id="customTema" placeholder="Tema"/>
      <input id="customSinergie" placeholder="Sinergie (classe/tratto/party)"/>
      <div class="muted">Modifica i dettagli in <a href="#/oggetti">Oggetti Custom</a>. Il selettore pesca dal catalogo salvato.</div>
    </section>
    <section class="card">
      <h2>Background & Note di Ruolo</h2>
      <textarea id="background" placeholder="5–10 righe, motto, stile decisionale, legami chiave, ganci…"></textarea>
    </section>
  </script>

  <script type="text/template" id="view-tracker">
    <header class="page-head">
      <h1>📊 Tracker PA & Cicatrici</h1>
      <p class="muted">Regole complete in <a href="#/regole">Regole</a> — qui solo tracking operativo.</p>
    </header>
    <section class="card">
      <h2>Punti Arena</h2>
      <div class="grid g4">
        <div><label>PA iniziali</label><input id="pa" type="number" value="2"/></div>
        <div><label>PA attuali</label><input id="paNow" type="number" value="2"/></div>
        <div><label>Limite per round</label><input value="1" readonly/></div>
        <div class="muted" style="align-self:end">1 effetto/round/PG</div>
      </div>
      <div class="hr"></div>
      <div class="grid g2">
        <div>
          <label>Usi rapidi</label>
          <ul class="list">
            <li>1 PA: reroll qualsiasi d20.</li>
            <li>2 PA: PF pieni a inizio turno <i>oppure</i> rimuovi tutte le condizioni.</li>
            <li>2 PA: resurrezione d’emergenza + cicatrice.</li>
          </ul>
        </div>
        <div>
          <label>Log sessione</label>
          <textarea id="registro" placeholder="Data, scena, PA spesi/guadagnati, cicatrici, bottino..."></textarea>
        </div>
      </div>
    </section>
    <section class="card">
      <h2>Cicatrici & Corruzione</h2>
      <div class="grid g3">
        <div><label>Cicatrici Fisiche (x/3)</label><input id="cicFis"/></div>
        <div><label>Cicatrici Psicologiche (x/3)</label><input id="cicPsy"/></div>
        <div><label>Malus Corruzione attivi</label><input id="malusCorr"/></div>
      </div>
    </section>
    <section class="card">
      <h2>Mini-Tracker Party</h2>
      <table>
        <thead><tr><th>PG</th><th>PA</th><th>Cicatrici F/P</th><th>Malus</th><th>Note</th></tr></thead>
        <tbody id="partyTable"></tbody>
      </table>
      <button class="btn" id="btnAddPartyRow">+ riga PG</button>
    </section>
  </script>

  <!-- JavaScript dependencies -->
  <script type="module" src="js/app.js"></script>
</body>
</html>
