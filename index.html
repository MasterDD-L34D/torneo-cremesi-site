<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Torneo Cremesi — Sito Ufficiale (PF1e, ABP ON)</title>
  <link rel="icon" href="assets/favicon.png">
  <link rel="stylesheet" href="css/styles.css" />
  <meta name="theme-color" content="#e9506a" />
</head>
<body>
  <a class="skip-link" href="#app">Salta al contenuto principale</a>
  <button id="sidebarToggle" class="sidebar-toggle" aria-expanded="false" aria-controls="sidebar">
    <span class="sidebar-toggle__icon" aria-hidden="true">☰</span>
    <span class="sidebar-toggle__label">Menu</span>
  </button>
  <!-- Sidebar navigation -->
  <aside class="sidebar" id="sidebar" aria-hidden="false">
    <a class="brand" href="#/avvio">
      <img src="assets/logo.svg" alt="Logo" class="logo"/>
      <span>Torneo Cremesi</span>
    </a>
    <nav>
      <div class="nav-label">Navigazione</div>
      <a href="#/avvio" data-link>🚀 Avvio Rapido</a>
      <div class="nav-label">Parte A — Consultazione</div>
      <a href="#/ambientazione" data-link>🌍 Ambientazione</a>
      <a href="#/regole" data-link>🏆 Regole, PA, Cicatrici, Glossario</a>
      <a href="#/oggetti" data-link>💎 Oggetti Custom</a>
      <div class="nav-label">Parte B — Modificabile</div>
      <a href="#/scheda" data-link>📝 Scheda Compilabile</a>
      <a href="#/tracker" data-link>📊 Tracker PA & Cicatrici</a>
    </nav>
    <div class="sidebar-actions">
      <button id="btnExportJSON" class="btn">Esporta JSON</button>
      <button id="btnImportJSON" class="btn">Importa JSON</button>
      <button id="btnPrint" class="btn primary">Stampa / PDF</button>
    </div>
  </aside>

  <!-- Main content area where views are injected -->
  <main id="app" tabindex="-1">
    <!-- Le viste vengono iniettate via router definito in js/app.js -->
  </main>

  <!-- View templates (hidden in HTML, rendered by router) -->
  <script type="text/template" id="view-avvio">
    <header class="page-head">
      <h1>🚀 Avvio Rapido</h1>
      <p class="muted">Livello 7 • ABP ON • EITR ON • Budget 11.750 mo • No consumabili/slotless • 1 oggetto custom opzionale</p>
    </header>
    <section class="card">
      <h2>Checklist lampo</h2>
      <ul class="list">
        <li>Scegli 1 <b>Tratto di Campagna (TC)</b> (niente doppioni nel party).</li>
        <li>Applica <b>EITR</b> ai talenti.</li>
        <li>Rispetta <b>ABP ON</b>: evita i Big Six e i duplicati dei bonus coperti.</li>
        <li>Spendi ≤ <b>11.750 mo</b>. No consumabili/slotless all’avvio.</li>
        <li>Proponi 1 <b>Oggetto Custom</b> (opzionale): tema, effetto, trigger, prezzo, sinergie.</li>
        <li>Compila <b>Scheda</b> e leggi i <b>PA & Cicatrici</b> (resurrezione d’emergenza a 2 PA).</li>
      </ul>
      <div class="quicklinks">
        <a href="#/scheda" class="pill">→ Vai alla Scheda</a>
        <a href="#/oggetti" class="pill">→ Vai agli Oggetti Custom</a>
        <a href="#/regole" class="pill">→ Vai alle Regole & PA</a>
        <a href="#/ambientazione" class="pill">→ Vai all’Ambientazione</a>
        <a href="#/tracker" class="pill">→ Vai al Tracker</a>
      </div>
    </section>
    <section class="card">
      <h2>Creazione del Personaggio (riassunto)</h2>
      <ol class="list num">
        <li>Definisci <b>razza, classi e archetipi</b> e seleziona il tuo <b>TC</b>.</li>
        <li>Assegna le <b>statistiche</b> principali (Forza, Destrezza, etc.), mod, difese e attacchi.</li>
        <li>Scegli i <b>talenti</b> con EITR, i <b>tratti</b> (TC + 1; opzionale 3° con drawback) e gli eventuali <b>difetti</b>.</li>
        <li>Prepara <b>incantesimi</b> o capacità magiche e identifica le <b>abilità</b> chiave.</li>
        <li>Componi il <b>loadout</b> rispettando ABP/budget e progetta l’<b>oggetto custom</b> (se previsto).</li>
        <li>Scrivi una breve <b>descrizione</b>, definisci <b>palette</b>, <b>motto</b> e scegli un’immagine.</li>
      </ol>
      <p class="muted">Suggerimento: compila prima i campi essenziali e affina in gioco. Trovi il modulo completo nella sezione Scheda.</p>
    </section>
  </script>

  <script type="text/template" id="view-ambientazione">
    <header class="page-head">
      <h1>🌍 Ambientazione — Fangwood</h1>
      <p class="muted">Luna immobile • Discesa Celeste • Foresta antica e capricciosa</p>
    </header>
    <section class="card">
      <h2>TL;DR</h2>
      <ul class="list">
        <li>Arrivo in <b>Discesa Celeste</b>: risvegliatevi nella Fangwood senza ricordi del viaggio.</li>
        <li>La Fangwood è una foresta viva: <i>ascoltate</i> prima di agire e <i>restate uniti</i>.</li>
        <li>Presenze ai margini, simboli cremisi, la luna immobile: l’atmosfera è carica di mistero.</li>
      </ul>
    </section>
    <section class="card">
      <h2>Scena d’apertura</h2>
      <p>Dopo la Discesa Celeste, il cielo è solcato da comete bianche. Un cerchio di rune incandescente vi accoglie al vostro risveglio. La Proclamazione del Torneo risuona tra gli alberi mentre nebbia cremisi apre un varco nella Fangwood. Ricordate chi siete e il legame con il vostro TC, ma non come siete giunti qui. Presenze osservano dai bordi, invitandovi a proseguire.</p>
      <p>Il GM fornirà ulteriori dettagli narrativi durante l’introduzione. Questa sezione serve come riferimento rapido per l’ambientazione e le prime sensazioni della campagna.</p>
    </section>
  </script>

  <script type="text/template" id="view-regole">
    <header class="page-head">
      <h1>🏆 Regole • Sistema a Punti • Cicatrici • Glossario</h1>
      <p class="muted">Sistema: PF1e RAW Paizo • ABP ON • EITR ON • SSOT: questo sito e il compendio del tavolo</p>
    </header>
    <section class="card">
      <h2>Regole base & Toggles</h2>
      <ul class="list">
        <li><b>Livello iniziale:</b> 7.</li>
        <li><b>Fonti consentite:</b> esclusivamente materiale Paizo (no 3PP).</li>
        <li><b>EITR ON:</b> prerequisiti e tassazione talenti semplificati; consultate il profilo EITR del tavolo.</li>
        <li><b>ABP ON:</b> bonus di arma, armatura, scudo, deflessione, resistenza e enhancement alle caratteristiche sono gestiti in automatico; evitate duplicazioni di bonus.</li>
        <li><b>Budget equipaggiamento:</b> 11.750 mo per PG. Non sono consentiti consumabili o oggetti slotless all’avvio.</li>
      </ul>
    </section>
    <section class="card" id="rule-eitr">
      <h2>🐘 Elephant in the Room (EITR)</h2>
      <p class="muted small-note">Attiva il toggle nella scheda per applicare automaticamente le modifiche sottostanti.</p>
      <p class="muted small-note"><b>Fonti:</b> <span data-eitr-sources></span></p>
      <h3>Principi chiave</h3>
      <ul class="list" data-eitr-summary></ul>
      <div class="grid g2">
        <div>
          <h3>Talenti concessi o accorpati</h3>
          <ul class="list" data-eitr-free></ul>
        </div>
        <div>
          <h3>Catene e prerequisiti modificati</h3>
          <ul class="list" data-eitr-adjusted></ul>
        </div>
      </div>
      <h3>Adattamenti di classe</h3>
      <ul class="list list--nested" data-eitr-classes></ul>
      <h3>Altre regole EITR applicate</h3>
      <ul class="list" data-eitr-other></ul>
      <p class="muted small-note" data-eitr-notes></p>
    </section>
    <section class="card" id="rule-abp">
      <h2>✨ Automatic Bonus Progression (ABP)</h2>
      <ul class="list" data-abp-summary></ul>
      <div class="table-wrapper">
        <table class="table abp-table" data-abp-table>
          <thead>
            <tr>
              <th>Livello</th>
              <th>Bonus acquisiti (cumulativi)</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <p class="muted small-note" data-abp-note></p>
      <div class="grid g2">
        <div>
          <h3>Conversione Potenza</h3>
          <ul class="list" data-abp-conversion="potency"></ul>
        </div>
        <div>
          <h3>Conversione Resilienza</h3>
          <ul class="list" data-abp-conversion="resilience"></ul>
        </div>
      </div>
      <h3>Linee guida per il bottino</h3>
      <ul class="list" data-abp-loot></ul>
      <h3>Note operative</h3>
      <ul class="list" data-abp-notes></ul>
    </section>
    <section class="card">
      <h2>🎲 Sistema a Punti (PA)</h2>
      <ul class="list">
        <li>Ogni personaggio inizia con <b>2 PA</b>.</li>
        <li><b>1 PA:</b> reroll di qualsiasi d20 (tuo, alleato o avversario).</li>
        <li><b>2 PA:</b> recupera PF massimi all’inizio del tuo turno <i>(azione di round completo)</i> <b>oppure</b> rimuovi tutte le condizioni.</li>
        <li><b>2 PA:</b> resurrezione d’emergenza: torni in vita con 1 PF e acquisisci una cicatrice narrativa.</li>
        <li><b>Limite:</b> 1 effetto PA per round per personaggio.</li>
        <li><b>Corruzione:</b> alcune scelte (fallimenti critici, tradimenti, condotta codarda) generano malus <i>–1 ai PA ottenuti per evento</i> (min. 0).</li>
      </ul>
    </section>
    <section class="card">
      <h2>🩹 Cicatrici & Corruzione (sintesi)</h2>
      <ul class="list">
        <li>Potete accumulare fino a 3 cicatrici fisiche e 3 psicologiche senza malus immediati.</li>
        <li>Due cicatrici sulla stessa caratteristica comportano –1 permanente a quella caratteristica.</li>
        <li>Le cicatrici possono essere curate con 2 PA o tramite magie appropriate.</li>
      </ul>
    </section>
    <section class="card">
      <h2>🎁 Ricompense & Loot (ABP)</h2>
      <ul class="list">
        <li><b>Niente duplicati</b> dei bonus coperti da ABP (arma/armatura/scudo, deflessione, resistenza, enhancement alle caratteristiche, ecc.).</li>
        <li><b>Ricompense tematiche:</b> utility narrative legate a sensi, movimento, comunicazione, chiavi narrative (sigilli, emblemi) o effetti limitati al torneo.</li>
        <li><b>Indipendenza dai TC:</b> gli oggetti non replicano né potenziano direttamente i poteri dei Tratti di Campagna (TC01–TC06).</li>
      </ul>
      <p class="muted">Consulta la sezione <a href="#/oggetti">Oggetti Custom</a> per esempi di ricompense e il manuale del GM per linee guida complete.</p>
    </section>
<section class="card">
  <h2>📌 Glossario lampo</h2>
  <p><b>LI</b> = Livello Incantatore; <b>TS</b> = Tiri Salvezza; <b>TxC</b> = Tiro per Colpire; <b>PF</b> = Punti Ferita; <b>CD</b> = Classe Difficoltà; <b>RD</b> = Riduzione del Danno; <b>SR</b> = Resistenza agli Incantesimi; <b>RAW</b> = Rules As Written; <b>HR</b> = House Rules.</p>
  <p><b>Unità & formati:</b> moneta in <i>gp</i>, peso in <i>lb</i>, distanze in metri, tempo in round/minuti/ore.</p>
  <p><b>Incantesimi</b> sono indicati in <i>corsivo</i>; <b>condizioni</b> (es. <b>accecato</b>, <b>sfocatura</b>) in grassetto.</p>
  <p><b>Tipi di bonus:</b> competenza, circostanziale, schivare, morale, sacro, ecc.; evita duplicare bonus dello stesso tipo (ABP li copre già).</p>
  <p>Consulta il compendio del tavolo per la lista completa di termini e definizioni.</p>
</section>
  </script>

  <script type="text/template" id="view-oggetti">
    <header class="page-head">
      <h1>💎 Oggetti Custom</h1>
      <p class="muted">Archivio locale di oggetti magici custom sviluppati per il Torneo Cremesi. Puoi creare, modificare e cercare oggetti; la scheda collegata li importa tramite il selettore.</p>
    </header>
    <section class="card">
      <h2>Catalogo (salvato in locale)</h2>
      <div class="row">
        <input id="ocSearch" placeholder="Cerca per nome, slot o tag…" />
        <button id="btnNewOC" class="btn">+ Nuovo oggetto</button>
        <button id="btnSeedOC" class="btn">Carica esempi</button>
      </div>
      <table class="table" id="ocTable">
        <thead><tr>
          <th>Nome</th>
          <th>Slot</th>
          <th>LI</th>
          <th>Prezzo</th>
          <th>Rarità</th>
          <th></th>
        </tr></thead>
        <tbody></tbody>
      </table>
    </section>
    <section class="card">
      <h2>Editor Oggetto</h2>
      <div class="grid g3">
        <div><label>Nome</label><input id="ocNome"></div>
        <div><label>Slot</label><input id="ocSlot" placeholder="Testa/Spalle/Occhi/Collo/Anello/—"></div>
        <div><label>LI</label><input id="ocLI" type="number" min="1"></div>
        <div><label>Prezzo (gp)</label><input id="ocPrezzo" type="number" min="0" step="50"></div>
        <div><label>Rarità</label><select id="ocRarita">
          <option>Comune</option>
          <option>Non comune</option>
          <option>Raro</option>
          <option>Unico</option>
        </select></div>
        <div><label>[HR]</label><select id="ocHR"><option>No</option><option>Sì</option></select></div>
      </div>
      <div class="grid g2">
        <div><label>Azioni / Usi / Durata</label><input id="ocAzioni" placeholder="Veloce; 1/g; 1 min"></div>
        <div><label>TS / SR</label><input id="ocTS" placeholder="Tempra CD 15; SR: No"></div>
      </div>
      <div class="grid">
        <label>Effetto (1 riga)</label><input id="ocEffetto"/>
      </div>
      <div class="grid">
        <label>Dettagli (max 3 bullet — una per riga)</label>
        <textarea id="ocDettagli" placeholder="- …&#10;- …&#10;- …"></textarea>
      </div>
      <div class="row">
        <button id="btnSaveOC" class="btn primary">Salva/aggiorna</button>
        <button id="btnDeleteOC" class="btn">Elimina</button>
        <span id="ocStatus" class="muted"></span>
      </div>
    </section>
  </script>

  <script type="text/template" id="view-scheda">
  <header class="page-head">
    <h1>📝 Scheda Compilabile</h1>
    <p class="muted">Salvataggio automatico in localStorage • Esporta/Importa JSON • Stampa PDF</p>
  </header>
  <section class="card scheda-tabs-card">
    <nav class="scheda-tabs__nav" role="tablist" aria-label="Sottoschede della scheda personaggio">
      <button
        type="button"
        class="scheda-tabs__btn"
        id="tab-scheda-legacy"
        data-tab-target="scheda-legacy"
        data-tab-route="completa"
        data-tab-default
        role="tab"
        aria-controls="panel-scheda-legacy"
        aria-selected="true"
      >📑 Scheda completa</button>
      <button
        type="button"
        class="scheda-tabs__btn"
        id="tab-scheda-generali"
        data-tab-target="scheda-generali"
        data-tab-route="dati-generali"
        role="tab"
        aria-controls="panel-scheda-generali"
        aria-selected="false"
        tabindex="-1"
      >🧾 Dati Generali</button>
    </nav>
    <p class="muted small-note">Consulta la scheda completa oppure compila i dati anagrafici attraverso le nuove sottoschede tematiche.</p>
  </section>
  <div class="scheda-panels">
    <div
      class="scheda-panel"
      id="panel-scheda-legacy"
      data-tab-panel="scheda-legacy"
      role="tabpanel"
      aria-labelledby="tab-scheda-legacy"
      tabindex="0"
    >
      <section class="card">
        <h2>Dati Anagrafici (legacy)</h2>
        <p class="muted small-note">I campi sono sincronizzati con la scheda "Dati Generali".</p>
        <div class="grid g2">
          <div><label>Nome PG</label><input id="nome" data-field="nome" readonly/></div>
          <div><label>Razza / Classi / Archetipi</label><input id="razzaClassi" data-field="razzaClassiSynth" readonly/></div>
          <div><label>Livello Totale</label><input id="livello" data-field="livello" value="7" readonly/></div>
          <div><label>Allineamento / Divinità</label><input id="allineamento" data-field="allineamentoSynth" readonly/></div>
          <div><label>Taglia / Età / Genere</label><input id="taglia" data-field="tagliaSintesi" readonly/></div>
          <div><label>Altezza / Peso</label><input id="altezza" data-field="misureSintesi" readonly/></div>
        </div>
      </section>
      <section class="card">
        <h2>Dati Fisici</h2>
        <div class="grid g3">
          <div><label>Palette</label><input id="palette" data-field="palette"/></div>
          <div><label>Motto</label><input id="motto" data-field="motto"/></div>
          <div><label>Immagine (URL)</label><input id="imgUrl" data-field="imgUrl" placeholder="https://…"/></div>
        </div>
        <div class="grid"><label>Descrizione</label><textarea id="descrizione" data-field="descrizione"></textarea></div>
      </section>
      <section class="card stats">
        <h2>Statistiche</h2>
        <table>
          <thead><tr><th>Stat</th><th>Val</th><th>Mod</th></tr></thead>
          <tbody id="statsBody"></tbody>
        </table>
      </section>
      <section class="card">
        <h2>Tratto di Campagna</h2>
        <div class="grid g3">
          <div><label>Seleziona TC</label><select id="tcSelect" data-tc-select></select></div>
          <div><label>Codice</label><input id="tcCode" data-tc-code readonly/></div>
          <div><label>Titolo</label><input id="tcTitle" data-tc-title readonly/></div>
        </div>
        <div class="grid g2">
          <div><label>Narrativa (auto)</label><textarea id="tcNarr" data-tc-narr readonly></textarea></div>
          <div><label>Regole RAW (auto)</label><ul id="tcRaw" data-tc-raw class="auto-list"></ul></div>
        </div>
      </section>
      <section class="card">
        <h2>Difese</h2>
        <div class="grid g3 defenses-grid">
          <div><label>PF totali</label><input id="pf" data-field="pf"/></div>
          <div><label>CA Tot / Cont / Sorpr.</label><input id="ca" data-field="ca" placeholder="— / — / —"/></div>
          <div><label>TS (Temp / Rif / Vol)</label><input id="ts" data-field="ts" placeholder="— / — / —"/></div>
          <div><label>BAB</label><input id="bab" data-field="bab"/></div>
          <div><label>CMB / CMD</label><input id="cmbcmd" data-field="cmbcmd" placeholder="— / —"/></div>
          <div><label>Iniziativa</label><input id="iniziativa" data-field="iniziativa"/></div>
        </div>
        <div class="grid">
          <div><label>Velocità</label><input id="velocita" data-field="velocita"/></div>
        </div>
      </section>
      <section class="card">
        <h2>Attacchi &amp; Manovre</h2>
        <div class="grid">
          <table>
            <thead><tr><th>Arma / Attacco</th><th>Attacco Totale</th><th>Danni</th><th>Critico</th><th>Portata</th><th>Note</th></tr></thead>
            <tbody id="atkTable"></tbody>
          </table>
          <button class="btn" id="btnAddAtkRow">+ riga</button>
        </div>
        <p class="muted small-note">Manovre CMB: Disarm — · Trip — · Grapple — · Bull Rush — · Sunder —</p>
      </section>
      <section class="card">
        <h2>Abilità (principali)</h2>
        <textarea id="skills" data-field="skills" placeholder="Percezione — ; Furtività — ; Sopravvivenza — ; Sapienza Magica — ; Acrobazia — ; Diplomazia — ; Intuizione —."></textarea>
      </section>
      <section class="card">
        <h2>Incantesimi / Capacità</h2>
        <div class="grid">
          <table>
            <thead><tr><th>Livello</th><th>Slot/giorno</th><th>CD base</th><th>Incantesimi principali</th></tr></thead>
            <tbody id="spellTable">
              <tr><td>0°</td><td contenteditable></td><td contenteditable></td><td contenteditable></td></tr>
              <tr><td>1°</td><td contenteditable></td><td contenteditable></td><td contenteditable></td></tr>
              <tr><td>2°</td><td contenteditable></td><td contenteditable></td><td contenteditable></td></tr>
              <tr><td>3°</td><td contenteditable></td><td contenteditable></td><td contenteditable></td></tr>
            </tbody>
          </table>
        </div>
      </section>
      <section class="card scheda-group" id="scheda-competenze">
        <header class="scheda-group__header">
          <h2>Talenti &amp; Competenze</h2>
          <p class="muted">Talenti, tratti, difetti, abilità e proficienze consolidate.</p>
        </header>
        <div class="scheda-subgrid">
          <article class="subcard">
            <h3>Talenti, tratti &amp; difetti</h3>
            <div class="grid">
              <div><label>Talenti (EITR ON)</label><textarea id="talenti" data-field="talenti"></textarea></div>
              <div><label>Tratti</label><textarea id="tratti" data-field="tratti"></textarea></div>
              <div><label>Difetti</label><textarea id="difetti" data-field="difetti"></textarea></div>
            </div>
          </article>
          <article class="subcard">
            <h3>Proficienze</h3>
            <div class="grid g2 compact">
              <div><label>Armi semplici</label><input id="profArmiSemplici" data-field="profArmiSemplici" placeholder="Semplici"/></div>
              <div><label>Fonte</label><input id="profArmiSempliciFonte" data-field="profArmiSempliciFonte" placeholder="Fonte"/></div>
            </div>
            <div class="grid g2 compact">
              <div><label>Armi marziali</label><input id="profArmiMarziali" data-field="profArmiMarziali" placeholder="Marziali"/></div>
              <div><label>Fonte</label><input id="profArmiMarzialiFonte" data-field="profArmiMarzialiFonte" placeholder="Fonte"/></div>
            </div>
            <div class="grid g2 compact">
              <div><label>Armi esotiche</label><input id="profArmiEsotiche" data-field="profArmiEsotiche" placeholder="Esotiche"/></div>
              <div><label>Fonte</label><input id="profArmiEsoticheFonte" data-field="profArmiEsoticheFonte" placeholder="Fonte"/></div>
            </div>
            <div class="grid g2 compact">
              <div><label>Armature leggere</label><input id="profArmatureLeggere" data-field="profArmatureLeggere" placeholder="Leggere"/></div>
              <div><label>Fonte</label><input id="profArmatureLeggereFonte" data-field="profArmatureLeggereFonte" placeholder="Fonte"/></div>
            </div>
            <div class="grid g2 compact">
              <div><label>Armature medie</label><input id="profArmatureMedie" data-field="profArmatureMedie" placeholder="Medie"/></div>
              <div><label>Fonte</label><input id="profArmatureMedieFonte" data-field="profArmatureMedieFonte" placeholder="Fonte"/></div>
            </div>
            <div class="grid g2 compact">
              <div><label>Armature pesanti</label><input id="profArmaturePesanti" data-field="profArmaturePesanti" placeholder="Pesanti"/></div>
              <div><label>Fonte</label><input id="profArmaturePesantiFonte" data-field="profArmaturePesantiFonte" placeholder="Fonte"/></div>
            </div>
            <div class="grid g2 compact">
              <div><label>Scudi</label><input id="profScudi" data-field="profScudi" placeholder="Scudi"/></div>
              <div><label>Fonte</label><input id="profScudiFonte" data-field="profScudiFonte" placeholder="Fonte"/></div>
            </div>
            <div class="grid g2 compact">
              <div><label>Scudi pesanti</label><input id="profScudiPesanti" data-field="profScudiPesanti" placeholder="Scudi pesanti"/></div>
              <div><label>Fonte</label><input id="profScudiPesantiFonte" data-field="profScudiPesantiFonte" placeholder="Fonte"/></div>
            </div>
            <div class="grid g2 compact">
              <div><label>Scudi torre</label><input id="profScudiTorre" data-field="profScudiTorre" placeholder="Scudi torre"/></div>
              <div><label>Fonte</label><input id="profScudiTorreFonte" data-field="profScudiTorreFonte" placeholder="Fonte"/></div>
            </div>
            <div><label>Categorie / Tipi aggiuntivi</label><textarea id="profCategorieExtra" data-field="profCategorieExtra"></textarea></div>
          </article>
        </div>
      </section>
      <section class="card">
        <h2>Altri Dati (riassunto)</h2>
        <div class="grid g3 summary-grid">
          <div class="grid">
            <div><label>Razza (tratti chiave)</label><textarea id="riassRazza" data-field="riassRazza"></textarea></div>
            <div><label>Classi &amp; livelli</label><textarea id="riassClassi" data-field="riassClassi"></textarea></div>
          </div>
          <div class="grid">
            <div><label>Movimento</label><textarea id="riassMovimento" data-field="riassMovimento" placeholder="Terra, Volo, Nuoto, Scavare, Scalare"></textarea></div>
            <div><label>Visione / Sensi</label><textarea id="riassSensi" data-field="riassSensi" placeholder="Olfatto acuto, percezione cieca..."></textarea></div>
          </div>
          <div class="grid">
            <div><label>RD / Res / Immunità</label><textarea id="riassRD" data-field="riassRD"></textarea></div>
            <div><label>Capacità di Classe chiave</label><textarea id="riassCapacita" data-field="riassCapacita" placeholder="Nome • Breve effetto"></textarea></div>
          </div>
        </div>
      </section>
      <section class="card scheda-group" id="scheda-equip">
        <header class="scheda-group__header">
          <h2>Equipaggiamento &amp; Risorse</h2>
          <p class="muted">Budget residuo, valute, oggetto custom e loadout.</p>
        </header>
        <div class="scheda-subgrid">
          <article class="subcard">
            <h3>Inventario sintetico</h3>
            <div class="grid g2 equip-grid">
              <div class="grid">
                <div><label>Budget rimanente (mo)</label><input id="budget" data-field="budget"/></div>
                <div class="grid g4 compact">
                  <div><label>PP</label><input id="pp" data-field="pp"/></div>
                  <div><label>GP</label><input id="gp" data-field="gp"/></div>
                  <div><label>SP</label><input id="sp" data-field="sp"/></div>
                  <div><label>CP</label><input id="cp" data-field="cp"/></div>
                </div>
              </div>
              <div class="grid">
                <div><label>Oggetto Custom su Misura</label><input id="customTema" data-field="customTema" placeholder="Nome / slot / LI…"/></div>
                <div><label>Scegli dall’Archivio Oggetti</label><select id="ocPicker"></select></div>
                <div class="grid g2 compact">
                  <div><label>Trigger / Limiti</label><input id="customTrigger" data-field="customTrigger"/></div>
                  <div><label>Prezzo stimato</label><input id="customCosto" data-field="customCosto"/></div>
                </div>
                <div><label>Sinergie (classe / tratto / party)</label><input id="customSinergie" data-field="customSinergie"/></div>
                <p class="muted small-note">Modifica i dettagli in <a href="#/oggetti">Oggetti Custom</a>. Il selettore pesca dal catalogo salvato.</p>
              </div>
            </div>
          </article>
        </div>
        <div class="grid g2 loadout-grid">
          <div><label>Loadout principale</label><textarea id="loadout" data-field="loadout" placeholder="Armi, armature, utility core..."></textarea></div>
          <div><label>Altri oggetti / Note</label><textarea id="altro" data-field="altro" placeholder="Consumabili, pozioni, risorse narrative..."></textarea></div>
        </div>
      </section>
      <section class="card scheda-group" id="scheda-narrazione">
        <header class="scheda-group__header">
          <h2>Narrazione</h2>
          <p class="muted">Riassunto di ruolo, tono e spunti per il personaggio.</p>
        </header>
        <div class="scheda-subgrid">
          <article class="subcard">
            <h3>Background &amp; note di ruolo</h3>
            <textarea id="background" data-field="background" placeholder="5–10 righe, motto, stile decisionale, legami chiave, ganci…"></textarea>
          </article>
        </div>
      </section>
    </div>
    <div
      class="scheda-panel"
      id="panel-scheda-generali"
      data-tab-panel="scheda-generali"
      role="tabpanel"
      aria-labelledby="tab-scheda-generali"
      tabindex="-1"
      hidden
    >
      <section class="card">
        <header class="scheda-panel__header">
          <h2>Dati Generali</h2>
          <p class="muted">Compila o aggiorna le informazioni anagrafiche con dati collegati al database di Archives of Nethys.</p>
        </header>
        <div class="grid g2">
          <div><label for="dgNome">Nome PG</label><input id="dgNome" data-field="nome" placeholder="Nome del personaggio"/></div>
          <div><label for="dgLivello">Livello attuale</label><input id="dgLivello" type="number" min="1" max="20" step="1" data-field="livello"/></div>
        </div>
        <fieldset class="scheda-fieldset">
          <legend>Identità &amp; Aspetto</legend>
          <div class="grid g3">
            <div><label for="dgEta">Età</label><input id="dgEta" data-field="eta" placeholder="Anni"/></div>
            <div><label for="dgEtaStage">Fascia d'età</label><select id="dgEtaStage" data-field="etaStage" data-age-stage-select></select><p class="muted small-note" id="dgEtaBonus"></p></div>
            <div><label for="dgGenere">Genere</label><input id="dgGenere" data-field="genere" placeholder="Identità / pronome"/></div>
          </div>
          <div class="grid g3">
            <div><label for="dgCapelli">Capelli</label><input id="dgCapelli" data-field="capelli"/></div>
            <div><label for="dgOcchi">Occhi</label><input id="dgOcchi" data-field="occhi"/></div>
            <div><label for="dgPalette">Palette</label><input id="dgPalette" data-field="palette"/></div>
          </div>
        </fieldset>
        <fieldset class="scheda-fieldset">
          <legend>Fede &amp; Origini</legend>
          <div class="grid g3">
            <div><label for="dgAllineamento">Allineamento</label><select id="dgAllineamento" data-field="alignment" data-align-select></select><p class="muted small-note" id="dgAllineamentoNote"></p></div>
            <div><label for="dgDivinita">Divinità</label><input id="dgDivinita" data-field="divinita" placeholder="Nome della divinità"/></div>
            <div><label for="dgPatria">Madre Patria</label><input id="dgPatria" data-field="madrePatria" placeholder="Paese / regione"/></div>
          </div>
        </fieldset>
        <fieldset class="scheda-fieldset">
          <legend>Retaggio &amp; Corpo</legend>
          <div class="grid g2">
            <div>
              <label for="dgRazza">Razza</label>
              <select id="dgRazza" data-field="razzaId"></select>
              <p class="muted small-note" id="dgRazzaFonte"></p>
            </div>
            <div>
              <label for="dgTaglia">Taglia</label>
              <select id="dgTaglia" data-field="taglia"></select>
              <p class="muted small-note" id="dgTagliaNote"></p>
            </div>
          </div>
          <div class="grid g2">
            <div>
              <label for="dgTrattiRazza">Tratti Raziali Alternativi</label>
              <select id="dgTrattiRazza" data-field="raceAltTraits" data-field-type="array" multiple size="5"></select>
              <p class="muted small-note" id="dgTrattiRazzaNote"></p>
            </div>
            <div class="grid g2 compact">
              <div>
                <label for="dgAltezza">Altezza</label>
                <input id="dgAltezza" data-field="altezzaVal" placeholder="cm"/>
                <p class="muted small-note" id="dgAltezzaRange"></p>
              </div>
              <div>
                <label for="dgPeso">Peso</label>
                <input id="dgPeso" data-field="pesoVal" placeholder="kg"/>
                <p class="muted small-note" id="dgPesoRange"></p>
              </div>
            </div>
          </div>
        </fieldset>
        <fieldset class="scheda-fieldset">
          <legend>Percorso &amp; Archetipi</legend>
          <div class="scheda-multiclass__toolbar">
            <button type="button" class="btn" id="dgToggleMulticlass" aria-pressed="false">Attiva Multiclasse</button>
            <button type="button" class="btn" id="dgAddClass" disabled>+ Aggiungi classe</button>
            <p class="muted small-note" id="dgMulticlassStatus" aria-live="polite"></p>
          </div>
          <div class="multiclass-single" data-multiclass-single>
            <div class="grid g2">
              <div>
                <label for="dgClasse">Classe</label>
                <select id="dgClasse" data-field="classeId"></select>
                <p class="muted small-note" id="dgClasseFonte"></p>
              </div>
              <div>
                <label for="dgArchetipi">Archetipi</label>
                <select id="dgArchetipi" data-field="archetypes" data-field-type="array" multiple size="5"></select>
                <p class="muted small-note" id="dgArchetipiNote"></p>
              </div>
            </div>
          </div>
          <div class="multiclass-panel" data-multiclass-panel hidden>
            <p class="muted small-note">Distribuisci i livelli complessivi nelle diverse classi e seleziona archetipi compatibili per ogni voce.</p>
            <div id="dgMulticlassList" class="multiclass-list"></div>
          </div>
        </fieldset>
        <fieldset class="scheda-fieldset">
          <legend>Campagna &amp; Regole</legend>
          <div class="grid g2">
            <div>
              <label for="dgTCSelect">Tratto di Campagna</label>
              <select id="dgTCSelect" data-tc-select></select>
              <div class="grid g2 compact" style="margin-top:10px;">
                <div><label>Codice</label><input data-tc-code readonly/></div>
                <div><label>Titolo</label><input data-tc-title readonly/></div>
              </div>
            </div>
            <div>
              <label>Regole opzionali</label>
              <div class="toggle-grid">
                <label class="toggle"><input type="checkbox" id="dgEitr" data-field="toggleEitr" checked/> <span>Elephant in the Room</span></label>
                <label class="toggle"><input type="checkbox" id="dgAbp" data-field="toggleAbp" checked/> <span>Automatic Bonus Progression</span></label>
              </div>
              <p class="muted small-note" id="dgRuleSummary"></p>
            </div>
          </div>
        </fieldset>
        <fieldset class="scheda-fieldset">
          <legend>Tratti Narrativi</legend>
          <div class="grid g2">
            <div>
              <label>Tratti (AON)</label>
              <select id="dgTrattiGenerali" data-field="traitsList" data-field-type="array" multiple size="6"></select>
              <p class="muted small-note" id="dgTrattiNote"></p>
            </div>
            <div>
              <label>Difetti (AON)</label>
              <select id="dgDifetti" data-field="drawbackList" data-field-type="array" multiple size="6"></select>
              <p class="muted small-note" id="dgDifettiNote"></p>
            </div>
          </div>
        </fieldset>
        <div class="grid g2">
          <div>
            <label>Narrativa TC</label>
            <textarea data-tc-narr readonly></textarea>
          </div>
          <div>
            <label>Regole TC</label>
            <ul data-tc-raw class="auto-list"></ul>
          </div>
        </div>
      </section>
    </div>
  </div>
</script>


  <script type="text/template" id="view-tracker">
    <header class="page-head">
      <h1>📊 Tracker PA & Cicatrici</h1>
      <p class="muted">Regole complete in <a href="#/regole">Regole</a> — qui solo tracking operativo.</p>
    </header>
    <section class="card">
      <h2>Punti Arena</h2>
      <div class="grid g4">
        <div><label>PA iniziali</label><input id="pa" type="number" value="2"/></div>
        <div><label>PA attuali</label><input id="paNow" type="number" value="2"/></div>
        <div><label>Limite per round</label><input value="1" readonly/></div>
        <div class="muted" style="align-self:end">1 effetto/round/PG</div>
      </div>
      <div class="hr"></div>
      <div class="grid g2">
        <div>
          <label>Usi rapidi</label>
          <ul class="list">
            <li>1 PA: reroll qualsiasi d20.</li>
            <li>2 PA: PF pieni a inizio turno <i>oppure</i> rimuovi tutte le condizioni.</li>
            <li>2 PA: resurrezione d’emergenza + cicatrice.</li>
          </ul>
        </div>
        <div>
          <label>Log sessione</label>
          <textarea id="registro" placeholder="Data, scena, PA spesi/guadagnati, cicatrici, bottino..."></textarea>
        </div>
      </div>
    </section>
    <section class="card">
      <h2>Cicatrici & Corruzione</h2>
      <div class="grid g3">
        <div><label>Cicatrici Fisiche (x/3)</label><input id="cicFis"/></div>
        <div><label>Cicatrici Psicologiche (x/3)</label><input id="cicPsy"/></div>
        <div><label>Malus Corruzione attivi</label><input id="malusCorr"/></div>
      </div>
    </section>
    <section class="card">
      <h2>Mini-Tracker Party</h2>
      <table>
        <thead><tr><th>PG</th><th>PA</th><th>Cicatrici F/P</th><th>Malus</th><th>Note</th></tr></thead>
        <tbody id="partyTable"></tbody>
      </table>
      <button class="btn" id="btnAddPartyRow">+ riga PG</button>
    </section>
  </script>

  <!-- JavaScript dependencies -->
  <script type="module" src="js/app.js"></script>
</body>
</html>
